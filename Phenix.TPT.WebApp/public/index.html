<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="lib/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="lib/fonts/font-awesome.min.css">
    <script>
        document.write("<link rel='stylesheet' href='base-style.css?v=" + new Date().toLocaleDateString() + "' charset='UTF-8'>");
    </script>
    <title>项目管理</title>
</head>

<body>
    <div id="menu"></div>

    <div class="content" id="content" v-cloak>
        <div class="container">
            <div class="header-line col-md-12">
                <h4>{{stateTitle[state]}}</h4>
                <div class="arrow-button">
                    <span class="arrow arrow-up" @click="onPlusMonth()" title="下一月"></span>
                    <label class="txt">{{filterTimeInterval.month}}</label>
                    <span class="arrow arrow-down" @click="onMinusMonth()" title="上一月"></span>
                </div>
                <div class="arrow-button">
                    <span class="arrow arrow-up" @click="onPlusYear()" title="下一年"></span>
                    <label class="txt">{{filterTimeInterval.year}}</label>
                    <span class="arrow arrow-down" @click="onMinusYear()" title="上一年"></span>
                </div>
                <div class="filter-button fa fa-filter" @click="onFilerProject()" :title="filterStateTitle[filterState]"></div>
            </div>
            <div class="panel col-md-12">
                <div class="panel panel-default">
                    <div class="panel-query panel-body">
                        <label class="panel-query-item txt col-md-1">项目</label>
                        <input class="panel-query-item txt-input col-md-4 form-control" placeholder="模糊查：项目名称/服务客户/销售区域/合同号" v-model="queryName">
                        <label class="panel-query-item txt col-md-1">负责人</label>
                        <input class="panel-query-item txt-input col-md-4 form-control" placeholder="模糊查：负责人姓名/产品版本/当前状态" v-model="queryPerson">
                        <button class="panel-query-item btn btn-primary col-md-1" @click="onQueryProject()">查询</button>
                        <button class="panel-query-item btn btn-primary col-md-1" v-bind:disabled="!canAddProject()" @click="onAddProject()">添加</button>
                    </div>
                </div>
                <ul class="panel panel-default">
                    <li v-for="(projectInfo) in filteredProjectInfos">
                        <div class="panel panel-default" :id="projectInfo.Id">
                            <div class="panel-list-item panel-body">
                                <div style="display: block; overflow: hidden;">
                                    <div class="panel-list-column" style="width: 9%; padding-left: 20px; margin-top: 5px; text-align: center;">
                                        <p class="text-wrapper" v-text="projectInfo.ContApproveDate"></p>
                                    </div>
                                    <div class="panel-list-column" style="width: 15%; padding-left: 10px; margin-top: 5px; text-align: center;">
                                        <p class="text-wrapper" v-text="(projectInfo.CurrentStatus??'')+'\n\r[ '+(projectInfo.AnnualMilestone??'') + ' ]'"></p>
                                    </div>
                                    <div class="panel-list-column" style="width: 40%; padding-left: 10px;">
                                        <div>
                                            <hr class="badge-chapter manage-color" v-bind:title="base.projectRoles.项目管理" v-if="projectInfo.ManageWork" />
                                            <hr class="badge-chapter no-color" v-bind:title="base.projectRoles.项目管理" v-else />
                                            <hr class="badge-chapter investigate-color" v-bind:title="base.projectRoles.调研分析" v-if="projectInfo.InvestigateWork" />
                                            <hr class="badge-chapter no-color" v-bind:title="base.projectRoles.调研分析" v-else />
                                            <hr class="badge-chapter develop-color" v-bind:title="base.projectRoles.设计开发" v-if="projectInfo.DevelopWork" />
                                            <hr class="badge-chapter no-color" v-bind:title="base.projectRoles.设计开发" v-else />
                                            <hr class="badge-chapter test-color" v-bind:title="base.projectRoles.测试联调" v-if="projectInfo.TestWork" />
                                            <hr class="badge-chapter no-color" v-bind:title="base.projectRoles.测试联调" v-else />
                                            <hr class="badge-chapter implement-color" v-bind:title="base.projectRoles.培训实施" v-if="projectInfo.ImplementWork" />
                                            <hr class="badge-chapter no-color" v-bind:title="base.projectRoles.培训实施" v-else />
                                            <hr class="badge-chapter maintenance-color" v-bind:title="base.projectRoles.质保维保" v-if="projectInfo.MaintenanceWork" />
                                            <hr class="badge-chapter no-color" v-bind:title="base.projectRoles.质保维保" v-else />
                                        </div>
                                        <div class="panel-list-column" style="word-wrap: break-word; word-break: break-all; height: auto; width: 100%;">
                                            <p class="text-wrapper">{{projectInfo.ProjectName}}</p>
                                        </div>
                                    </div>
                                    <div class="panel-list-column" style="width: 15%; padding-left: 10px; margin-top: 5px; text-align: center;">
                                        <p class="text-wrapper" v-text="(projectInfo.ContNumber??'').replace(/（/,'\n\r（')"></p>
                                    </div>
                                    <div class="panel-list-column" style="width: 6%; padding-left: 10px; margin-top: 5px; text-align: center;">
                                        <p>{{projectInfo.ProjectManager}}</p>
                                    </div>
                                    <div class="panel-list-column" style="width: 6%; padding-left: 10px; margin-top: 5px; text-align: center;">
                                        <p>{{projectInfo.DevelopManager}}</p>
                                    </div>
                                    <div class="panel-list-column" style="width: 9%; padding-left: 10px; margin-top: 5px; padding-right: 5px;">
                                        <i class="fa fa-tag" type="buttonon" @click="onShowMonthlyReport(projectInfo)" title="展开月报" v-if="!projectInfo.showingMonthlyReport"></i>
                                        <i class="fa fa-tags" type="buttonon" @click="onHideMonthlyReport(projectInfo)" title="收起月报" v-else></i>
                                        <i class="fa fa-toggle-on" type="buttonon" @click="showCloseProjectDialog(projectInfo)" title="项目归档" v-if="!projectInfo.showingProjectInfo && canCloseProject(projectInfo)"></i>
                                        <i class="fa fa-toggle-off" title="已归档" v-else v-if="!projectInfo.showingProjectInfo && !canCloseProject(projectInfo)"></i>
                                        <i class="fa fa-chevron-down" type="buttonon" @click="onShowProjectInfo(projectInfo)" title="展开项目" v-if="!projectInfo.showingProjectInfo && canEditProject(projectInfo)"></i>
                                        <i class="fa fa-save" type="buttonon" @click="onPutProjectInfo(projectInfo)" title="提交项目" v-else v-if="projectInfo.showingProjectInfo && canEditProject(projectInfo)"></i>
                                        <i class="fa fa-chevron-up" type="buttonon" @click="onHideProjectInfo(projectInfo)" title="收起项目" v-else v-if="projectInfo.showingProjectInfo"></i>
                                    </div>
                                </div>
                                <div class="panel panel-fold" v-show="projectInfo.showingProjectInfo">
                                    <div class="panel-fold-info">
                                        <div style="clear: both;">
                                            <div class="panel-fold-info-item">
                                                <label>合 同 号:</label>
                                                <input v-model="projectInfo.ContNumber">
                                            </div>
                                            <div class="panel-fold-info-item">
                                                <label>流转日期:</label>
                                                <input type="date" v-model="projectInfo.ContApproveDate">
                                            </div>
                                        </div>
                                        <div style="clear: both;">
                                            <div class="panel-fold-info-item">
                                                <label>项目名称:</label>
                                                <input v-model="projectInfo.ProjectName">
                                            </div>
                                            <div class="panel-fold-info-item">
                                                <label>项目类型:</label>
                                                <select v-model="projectInfo.ProjectType">
                                                    <option v-for="(item) in projectTypes" :key="item.Key" :label="item.Caption" :value="item.Value"></option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <ul class="panel" v-show="projectInfo.showingMonthlyReport">
                                    <li v-for="(monthlyReport, index) in projectInfo.monthlyReports">
                                        <div class="panel panel-fold">
                                            <div>
                                                <div class="panel-fold-header-item" style="width: 7%;">
                                                    <input v-bind:readonly="true" v-model="monthlyReport.Month">
                                                </div>
                                                <div class="panel-fold-header-item" style="width: 15%;">
                                                    <datalist id="project-statuses">
                                                        <option v-for="item in projectStatuses">{{item}}</option>
                                                    </datalist>
                                                    <input type="search" list="project-statuses" placeholder="填写/选择：项目状态" v-bind:readonly="!canPutMonthlyReport(projectInfo, monthlyReport)" v-model="monthlyReport.Status" @blur="monthlyReport.Status=$event.target.value">
                                                </div>
                                                <i class="fa fa-save" type="buttonon" @click="onPutMonthlyReport(projectInfo, monthlyReport)" title="提交月报" v-show="canPutMonthlyReport(projectInfo, monthlyReport)"></i>
                                            </div>
                                            <div style="clear: both;">
                                                <div class="panel-fold-area" style="width: 22%; margin-right: 1%;">
                                                    <span>月度计划</span>
                                                    <textarea v-bind:readonly="!canPutMonthlyReport(projectInfo, monthlyReport)" v-model="monthlyReport.MonthlyPlan"></textarea>
                                                </div>
                                                <div class="panel-fold-area" style="width: 22%; margin-right: 1%;">
                                                    <span>实绩完成</span>
                                                    <textarea v-bind:readonly="!canPutMonthlyReport(projectInfo, monthlyReport)" v-model="monthlyReport.MonthlyAchieve"></textarea>
                                                </div>
                                                <div class="panel-fold-area" style="width: 22%; margin-right: 1%;">
                                                    <span>下月计划</span>
                                                    <textarea v-bind:readonly="!canPutMonthlyReport(projectInfo, monthlyReport)" v-model="monthlyReport.NextMonthlyPlan"></textarea>
                                                </div>
                                                <div class="panel-fold-area" style="width: 10%; margin-right: 1%;">
                                                    <span>风险警示</span>
                                                    <textarea v-bind:readonly="!canPutMonthlyReport(projectInfo, monthlyReport)" v-model="monthlyReport.RiskCaution"></textarea>
                                                </div>
                                                <div class="panel-fold-area" style="width: 20%;">
                                                    <span>协调需求</span>
                                                    <textarea v-bind:readonly="!canPutMonthlyReport(projectInfo, monthlyReport)" v-model="monthlyReport.DemandCoordination"></textarea>
                                                </div>
                                                <i class="fa fa-chevron-down" type="buttonon" @click="onNextMonthlyReport(projectInfo)" title="以往月报" v-show="index===projectInfo.monthlyReports.length-1"></i>
                                                <i class="fa fa-chevron-up" type="buttonon" @click="onHideMonthlyReport(projectInfo)" title="收起月报"></i>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="modal fade" id="closeProjectDialog" tabindex="-1" role="dialog" aria-labelledby="closeProjectDialogLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="closeProjectDialogLabel">设置项目的关闭日期</h4>
                    </div>
                    <div class="modal-body">
                        <input type="date" v-model="closedDate">
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default" type="button" data-dismiss="modal">取消</button>
                        <button class="btn btn-primary" type="button" @click="onCloseProject()">提交</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="goto-top-button">
            <a title="返回顶部" href="#">
                <i class="fa fa-angle-up fa-2x" type="button"></i>
            </a>
        </div>
    </div>

    <script type="text/javascript" src="lib/crypto-js/core-min.js"></script>
    <script type="text/javascript" src="lib/crypto-js/enc-base64-min.js"></script>
    <script type="text/javascript" src="lib/crypto-js/cipher-core-min.js"></script>
    <script type="text/javascript" src="lib/crypto-js/aes-min.js"></script>
    <script type="text/javascript" src="lib/crypto-js/md5-min.js"></script>
    <script type="text/javascript" src="lib/json2.js"></script>
    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/jquery.cookie.js"></script>
    <script type="text/javascript" src="lib/jquery.base64.js"></script>
    <script type="text/javascript" src="lib/signalr.min.js"></script>
    <script type="text/javascript" src="lib/phenix7.js"></script>

    <script type="text/javascript" src="lib/vue.min.js"></script>
    <script type="text/javascript" src="lib/bootstrap/bootstrap.min.js"></script>
    <script type="text/javascript" src="lib/mesgbox.js"></script>

    <script type="text/javascript" src="base-func.js?v=1"></script>
    <script>
        document.write("<script type='text/javascript' src='index.js?v=" + new Date().toLocaleDateString() + "'><\/script>");
    </script>

    <div id="wait-hold"></div>
</body>

</html>